<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ShopX - Account</title>
  <link rel="stylesheet" href="./assets/css/style-prefix.css" />
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
</head>
<body>
  <main class="container section">
    <h1>Account</h1>
    <div id="info"></div>
    <h2>My Orders</h2>
    <div id="orders"></div>
  </main>

  <script type="module">
    import { onAuthChange } from './assets/js/app.js';
    import { listMyOrders } from './assets/js/app.js';
    import './assets/js/firebase.js';

    let user=null, profile=null;
    onAuthChange(async (u,p)=>{ user=u; profile=p; if(!u){ location.href='/ecommerce/login.html'; return;} render(); });

    async function render(){
      document.getElementById('info').innerHTML = `<p><strong>${user.displayName||user.email}</strong></p><p class="muted">Role: <strong>${profile?.primaryRole||'n/a'}</strong></p>`;
      const ords = await listMyOrders(user.uid);
      if (!ords.length) { document.getElementById('orders').innerHTML = '<p>No orders yet.</p>'; return; }
      document.getElementById('orders').innerHTML = ords.map(o=>`<div class="card"><div class="p"><div class="muted">${o.id}</div><div>Status: ${o.status}</div><div>Items: ${o.items.length} | Total: $${(o.subtotal||0).toFixed(2)}</div></div></div>`).join('');
    }
  </script>
</body>
</html>